# üõí E-commerce API

API REST desarrollada con **FastAPI** y conectada a una base de datos **PostgreSQL**, que incluye autenticaci√≥n JWT, gesti√≥n de usuarios con roles, carritos de compra, productos, √≥rdenes, pagos y sistema de facturaci√≥n.

## ‚ú® Caracter√≠sticas Principales

- üîê Autenticaci√≥n JWT con tokens de acceso y refresco
- üë• Gesti√≥n de usuarios con roles (comprador, vendedor)
- üõí Sistema de carrito de compras
- üì¶ Gesti√≥n de productos
- üìã Sistema de √≥rdenes y ventas
- üí≥ Procesamiento de pagos con m√∫ltiples m√©todos
- üìß Env√≠o de correos electr√≥nicos de confirmaci√≥n
- üìÑ Generaci√≥n autom√°tica de facturas con IVA
- üìö Documentaci√≥n autom√°tica con Swagger/OpenAPI

---

## üõ†Ô∏è Endpoints de la API

### üîë Autenticaci√≥n (`/auth`)

| M√©todo | Endpoint          | Descripci√≥n                                |
|--------|------------------|------------------------------------------|
| POST   | `/auth/register` | Registro de usuarios (comprador/vendedor)  |
| POST   | `/auth/login`    | Inicio de sesi√≥n y obtenci√≥n de tokens    |
| POST   | `/auth/refresh`  | Renovaci√≥n de token de acceso             |

### üë• Usuarios (`/users`)

| M√©todo | Endpoint        | Descripci√≥n                    |
|--------|----------------|--------------------------------|
| POST   | `/users/`      | Crear nuevo usuario            |
| GET    | `/users/`      | Listar usuarios (rol admin)    |
| GET    | `/users/{id}`  | Obtener detalles de usuario    |

### üì¶ Productos (`/products`)

| M√©todo | Endpoint           | Descripci√≥n                |
|--------|------------------|----------------------------|
| POST   | `/products/`     | Crear producto (vendedor)   |
| GET    | `/products/`     | Listar productos           |
| GET    | `/products/{id}` | Obtener producto           |
| PUT    | `/products/{id}` | Actualizar producto        |
| DELETE | `/products/{id}` | Eliminar producto          |

### üõí Carrito (`/carts`)

| M√©todo | Endpoint          | Descripci√≥n                |
|--------|------------------|----------------------------|
| POST   | `/carts/`        | Crear carrito             |
| GET    | `/carts/`        | Ver carrito actual        |
| POST   | `/carts/items`   | Agregar producto          |
| DELETE | `/carts/items`   | Eliminar producto         |
| PUT    | `/carts/items`   | Actualizar cantidad       |

### üìã √ìrdenes (`/orders`)

| M√©todo | Endpoint          | Descripci√≥n                |
|--------|------------------|----------------------------|
| POST   | `/orders/`       | Crear orden desde carrito  |
| GET    | `/orders/`       | Listar √≥rdenes            |
| GET    | `/orders/{id}`   | Ver detalles de orden     |

### üí≥ Pagos (`/payment`)

| M√©todo | Endpoint            | Descripci√≥n                      |
|--------|-------------------|----------------------------------|
| POST   | `/payment/process` | Procesar pago de orden          |

### üìä Ventas (`/sales`)

| M√©todo | Endpoint          | Descripci√≥n                |
|--------|------------------|----------------------------|
| GET    | `/sales/`        | Listar ventas             |
| GET    | `/sales/{id}`    | Ver detalles de venta     |


## üì¶ Modelo de Datos

![Modelo de Datos](docs/modelo%20de%20datos.png)

| Entidad   | Atributos |
|-----------|-----------|
| **Usuario** | ID, Nombre, Apellido, Email, Contrase√±a (hasheada), Rol (comprador/vendedor), Estado activo |
| **Producto** | ID, Nombre, Descripci√≥n, Precio, Stock, Categor√≠a, Vendedor ID |
| **Carrito** | ID, Usuario ID, Items, Total, Estado |
| **Orden** | ID, Usuario ID, Items, Total, Estado, Fecha de creaci√≥n, Fecha de pago |
| **Pago** | ID, Orden ID, Monto, M√©todo de pago, Estado, ID de transacci√≥n, Fecha |
| **Venta** | ID, Orden ID, N√∫mero de factura, Monto total, IVA, Estado, Fecha |

---

## üîí Seguridad y Autenticaci√≥n

### Autenticaci√≥n JWT
- Access Token (30 minutos)
- Refresh Token (7 d√≠as)
- Payload con rol de usuario

### Roles y Permisos
- üë§ Comprador: Gesti√≥n de carrito y √≥rdenes
- üè™ Vendedor: Gesti√≥n de productos
- üëë Admin: Acceso total al sistema

## üìÅ Estructura del Proyecto

```bash
.
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ models/        # Modelos SQLAlchemy
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cart.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ product.py 
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.py
‚îÇ   ‚îú‚îÄ‚îÄ routers/       # Rutas de la API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ carts.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ products.py 
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ users.py
‚îÇ   ‚îú‚îÄ‚îÄ schemas/       # Esquemas Pydantic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py 
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cart.py 
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ product.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.py
‚îÇ   ‚îú‚îÄ‚îÄ utils/         # Funciones utilitarias
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.py
‚îÇ   ‚îî‚îÄ‚îÄ database.py    # Configuraci√≥n de la base de datos
‚îú‚îÄ‚îÄ main.py           # Punto de entrada
‚îî‚îÄ‚îÄ requirements.txt  # Dependencias
```

---

## üöÄ Caracter√≠sticas

* üßæ Registro y autenticaci√≥n de usuarios
* üîê Seguridad con hashing de contrase√±as
* üõçÔ∏è Gesti√≥n de carritos de compra y productos
* üß© Estructura modular y escalable
* üóÑÔ∏è Conexi√≥n con PostgreSQL
* ‚úÖ Validaci√≥n robusta con Pydantic

---

## ‚öôÔ∏è Requisitos Previos

### 1. Python 3.9+

* Descargar desde [python.org](https://www.python.org/downloads/)
* Aseg√∫rate de activar la opci√≥n **"Add Python to PATH"** durante la instalaci√≥n

### 2. PostgreSQL

* Instalar desde [postgresql.org](https://www.postgresql.org/download/)
* Guardar la contrase√±a del usuario `postgres`
* Crear una base de datos para el proyecto

---

## üõ†Ô∏è Configuraci√≥n del Entorno

### 1. Clonar el Repositorio

```bash
git clone https://github.com/Starkware-713/e-comerce-backend
cd e-comerce-backend
```

### 2. Crear y Activar el Entorno Virtual

```bash
# Crear entorno virtual
python -m venv .venv

# Activar en PowerShell
.venv\Scripts\Activate.ps1

# Activar en CMD
.venv\Scripts\activate.bat
```

### 3. Instalar Dependencias

```bash
pip install -r requirements.txt
```

### 4. Crear archivo `.env`

```env
DATABASE_URL=postgresql://usuario:contrase√±a@localhost/nombre_db
PORT=8000  # Puerto opcional, por defecto 8000
```

> Reemplaza `usuario`, `contrase√±a` y `nombre_db` con tus datos reales.

---

## ‚ñ∂Ô∏è Ejecutar la Aplicaci√≥n

1. Aseg√∫rate de que PostgreSQL est√© activo
2. Verifica las credenciales en `.env`
3. Ejecuta el servidor con:

```bash
python main.py
# O alternativamente:
uvicorn main:app --reload
```

4. Abre en tu navegador: [http://localhost:8000/docs](http://localhost:8000/docs)

---

## üîÑ Endpoints de la API

### üîê Autenticaci√≥n

| M√©todo | Endpoint          | Descripci√≥n                                      | Acceso     |
| ------ | ---------------- | ------------------------------------------------ | ---------- |
| POST   | `/auth/register` | Registrar nuevo usuario (comprador/vendedor)      | P√∫blico    |
| POST   | `/auth/login`    | Iniciar sesi√≥n y obtener tokens                  | P√∫blico    |
| POST   | `/auth/refresh`  | Renovar token de acceso usando refresh token     | P√∫blico    |

### üë§ Usuarios

| M√©todo | Endpoint           | Descripci√≥n                 | Acceso      |
| ------ | ----------------- | --------------------------- | ----------- |
| POST   | `/users/`         | Crear nuevo usuario         | P√∫blico     |
| GET    | `/users/`         | Listar todos los usuarios   | Admin       |
| GET    | `/users/{id}`     | Obtener usuario por ID      | Autenticado |
| PUT    | `/users/{id}`     | Actualizar usuario          | Autenticado |
| DELETE | `/users/{id}`     | Eliminar usuario            | Admin       |

### üì¶ Productos

| M√©todo | Endpoint           | Descripci√≥n                | Acceso      |
| ------ | ----------------- | -------------------------- | ----------- |
| POST   | `/products/`      | Crear nuevo producto       | Vendedor    |
| GET    | `/products/`      | Listar todos los productos | P√∫blico     |
| GET    | `/products/{id}`  | Obtener producto por ID    | P√∫blico     |
| PUT    | `/products/{id}`  | Actualizar producto        | Vendedor    |
| DELETE | `/products/{id}`  | Eliminar producto          | Vendedor    |

### üõçÔ∏è Carritos de Compra

| M√©todo | Endpoint                    | Descripci√≥n                      | Acceso      |
| ------ | -------------------------- | -------------------------------- | ----------- |
| POST   | `/carts/`                  | Crear nuevo carrito              | Autenticado |
| GET    | `/carts/`                  | Listar carritos del usuario      | Autenticado |
| GET    | `/carts/{id}`              | Obtener carrito por ID          | Autenticado |
| POST   | `/carts/{id}/items`        | Agregar producto al carrito     | Autenticado |
| DELETE | `/carts/{id}/items/{item}` | Eliminar producto del carrito   | Autenticado |
| PUT    | `/carts/{id}/checkout`     | Procesar compra del carrito     | Autenticado |

---

## üìö Documentaci√≥n Detallada

### üîë Autenticaci√≥n y Autorizaci√≥n

La API utiliza autenticaci√≥n basada en JWT (JSON Web Tokens) con:
* Access Token: Para acceso a recursos protegidos (duraci√≥n: 30 minutos)
* Refresh Token: Para renovar el access token (duraci√≥n: 7 d√≠as)

#### Roles de Usuario
* üëë **Admin**: Acceso total al sistema
* üè™ **Vendedor**: Gesti√≥n de productos
* üõí **Comprador**: Gesti√≥n de carritos de compra

### üìñ Documentaci√≥n Interactiva
* [Swagger UI](http://localhost:8000/docs): Interfaz interactiva para probar endpoints
* [ReDoc](http://localhost:8000/redoc): Documentaci√≥n detallada y esquemas

---

## üîß Variables de Entorno Requeridas

```env
DATABASE_URL=postgresql://user:password@localhost:5432/dbname
PORT=8000
EMAIL_ADDRESS=your-email@gmail.com
EMAIL_PASSWORD=your-email-password
```

## üß∞ Soluci√≥n de Problemas

### ‚ùå Error de Conexi√≥n a la Base de Datos
* Aseg√∫rate de que PostgreSQL est√° activo
* Verifica las credenciales del archivo `.env`
* Confirma que la base de datos fue creada

### ‚ö†Ô∏è Error al Activar el Entorno Virtual
```bash
Set-ExecutionPolicy RemoteSigned
```
> Ejecutar como administrador en PowerShell

### üêç Problemas con Dependencias
```bash
python -m pip install --upgrade pip
pip install -r requirements.txt
```

## üì¶ Estado del Proyecto

En desarrollo activo. Versi√≥n actual: 1.0.0

## üìö Documentaci√≥n API

La documentaci√≥n completa de la API est√° disponible en:
- üîç Swagger UI: `http://localhost:8000/docs`
- üìñ ReDoc: `http://localhost:8000/redoc`
